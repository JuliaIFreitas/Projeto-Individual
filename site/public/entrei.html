<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENTREI - JULIA INADA DE FREITAS</title>
    <link rel="stylesheet" href="./css/entrei.css">
    <link rel="stylesheet" href="./css/modal.css">
    <!-- <script src="../src/js/addkata.js"></script> -->
    <!-- <script src="../src/js/script.js"></script> -->
    <!-- <script src="../src/js/entrei.js"></script> -->

    <style>
        /* ASSOCIAÇÃO */
        .modalAsso {
            width: 60%;
            height: 90%;
            position: fixed;
            top: 0;
            left: 0;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1;
            overflow: auto;
            margin: 2% 20%;
            border-radius: 5%;
            box-shadow: 0 5px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 10px 1000px rgba(0, 0, 0, 0.491);
        }

        .modalAsso .modalassociacao {
            width: 50%;
            min-width: 400px;
            min-height: 300px;
            background-color: rgba(235, 144, 144, 0.75);
            backdrop-filter: blur(10px);
            height: 70%;
            padding: 10%;
            border-radius: 5%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }

        /* .modalAsso .modalassociacao img {
    width: 120%;
    height: 100%;
    cursor: pointer;
} */

        .modalAsso.abrir {
            display: flex;
        }

        @keyframes abrir {
            from {
                opacity: 0;
                transform: translate3d(0, -20px, -5px);
            }

            to {
                opacity: 1;
                transform: translate3d(0, 0, 0);
            }
        }

        .abrir .modalAsso {
            animation: abrirfaixa 0.5s;
        }

        .fechar {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 8%;
            height: 8%;
            border-radius: 50%;
            border: 0;
            background-color: rgb(116, 54, 54);
            color: white;
            font-size: 20px;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <!-- <script src="/site/src/js/login.js"></script> -->

    <div class="arm">
        <div class="alerta_erro">
            <div class="card_erro" id="cardErro">
                <span id="mensagem_erro"></span>
            </div>
        </div>

        <div class="modalAsso" id="modalAsso">
            <div class="modalassociacao">
                <button class="fechar" id="fechar">X</button>
                <div class="divModalAsso">
                    <h1>Dados</h1><br>
                    <div class="asso">
                        <span>Associação:</span><br><input placeholder="Nome da Associação"
                            id="input_associacao"><br><br>
                        <span>Faixa:</span> <br>
                        <select class="select" name="" id="id_select">
                            <option value="branca">Branca(7° Kyu)</option>
                            <option value="amarela">Amarela(6° Kyu)</option>
                            <option value="vermelha">Vermelha(5° Kyu)</option>
                            <option value="laranja">Laranja(4° Kyu)</option>
                            <option value="verde">Verde(3° Kyu)</option>
                            <option value="roxa">Roxa(2° Kyu)</option>
                            <option value="marrom">Marrom(1° Kyu)</option>
                            <option value="preta">Preta(1° Dan)</option>
                            <option value="preta">Preta(2° Dan)</option>
                            <option value="preta">Preta(3° Dan)</option>
                            <option value="preta">Preta(4° Dan)</option>
                            <option value="preta">Preta(5° Dan)</option>
                            <option value="preta">Preta(6° Dan)</option>
                            <option value="preta">Preta(7° Dan)</option>
                            <option value="preta">Preta(8° Dan)</option>
                            <option value="preta">Preta(9° Dan)</option>
                            <option value="preta">Preta(10° Dan)</option>

                        </select><br><br>
                        <span>Sensei: </span><br><input placeholder="Nome do Sensei" id="input_sensei"><br><br>
                        <span>Medalhas: </span><br><input placeholder="Quantidade de Medalhas"
                            id="input_qtdMedalhas"><br>
                    </div>
                    <button class="botao" onclick="atualizarDados()">Adicionar</button>
                </div>
            </div>
        </div>
        <!-- Karate -->

        <div class="container">
            <div class="perfil">
                <img src="" alt="">
                <div class="descricao">
                    <p>
                    <div id="id_nome">
                        Nome:
                    </div>

                    <div id="id_dados">
                        Associação: <br>
                        Sensei: <br>
                        Faixa: <br>
                        Medalhas: <br><br>
                    </div>
                    <button onclick="addDados()">Adicionar Dados</button>
                    </p>
                </div>
            </div>
        </div>
        <div class="tela">
            <div class="metricas">
                <!-- <div class="competicao">
                    <h2>Próxima competição: </h2>
                    <div class="data">
                        <p><b>Brasileiro:</b> 10/12/2023</p>
                        <a href="https://www.karatedobrasil.com/">Saiba Mais</a>
                    </div>
                </div> -->


                <div class="tabelas">
                    <h2>Treinos da semana: </h2><br>
                    <div class="dados">
                        <div class="junior">
                            <div class="titulo">
                                Quantidade de treinos
                            </div>
                        </div>

                        <div class="junior">
                            <div class="primeira">
                                1
                            </div>
                        </div>

                        <div class="junior">
                            <div class="segunda">
                                2 ou 3
                            </div>
                        </div>

                        <div class="junior">
                            <div class="terceira">
                                4 a 6
                            </div>
                        </div>

                        <div class="junior">
                            <div class="quarta">
                                7 a 12
                            </div>
                        </div>

                        <div class="junior">
                            <div class="quinta">
                                26
                            </div>
                        </div>
                    </div>

                    <div class="dados">

                        <div class="junior">
                            <div class="titulo">
                                Designação
                            </div>
                        </div>

                        <div class="junior">
                            <div class="primeira">
                                Júnior
                            </div>
                        </div>

                        <div class="junior">
                            <div class="segunda">
                                Cheng
                            </div>
                        </div>

                        <div class="junior">
                            <div class="terceira">
                                Karate Kid
                            </div>
                        </div>

                        <div class="junior">
                            <div class="quarta">
                                Sr. Miyagi
                            </div>
                        </div>

                        <div class="junior">
                            <div class="quinta">
                                Funakoshi
                            </div>
                        </div>
                    </div>
                    <p>Digite o dia e o horário do treino: </p>
                    <input class="campo" placeholder="Dia do treino" id="input_diaTreino">
                    <input class="campo" placeholder="Hora do treino" id="input_horaTreino"><br><br>
                    <button id="id_botaoKata" onclick="adicionarTreino()">Adicionar Treino</button>
                    <div id="div_kata"></div>
                </div>
            </div>

            <div class="graficoKata">
                <div class="classificacao">
                    <p>Por saber 8 katas, você atualmente é "Cheng"</p>
                </div>
                <div class="kata">
                    <div>
                        <canvas class="kata" id="arm5" style="position: relative; width: 100%; height: 100%;"></canvas>
                    </div>
                </div>
            </div>        
        </div>
    </div>
</body>

</html>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>

    //   Colocando o nome do usuário
    var nome = sessionStorage.NOME_USUARIO;

    id_nome.innerHTML = `Nome: ${nome}`;

    // Dados do perfil
    function atualizarDados() {
        // aguardar();

        var nomeAssoVar = input_associacao.value;
        var faixaVar = id_select.value;
        var nomeSenseiVar = input_sensei.value;
        var medalhasVar = input_qtdMedalhas.value;

        if (
            nomeAssoVar == "" ||
            faixaVar == "" ||
            nomeSenseiVar == "" ||
            medalhasVar == ""
        ) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "Todos os campos estão em branco";

            // finalizarAguardar();
            return false;
        } else if (medalhasVar < 0) {
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "Insira uma quantidade válida";

            // finalizarAguardar();
            return false;
        } else {
            setInterval(sumirMensagem, 5000);
            cardErro.style.display = "block";
            mensagem_erro.innerHTML =
                "Atualizando dados...";
        }

        fetch("/dash/atualizarDados", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                nomeAssoServer: nomeAssoVar,
                faixaServer: faixaVar,
                nomeSenseiServer: nomeSenseiVar,
                medalhasServer: medalhasVar

            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    console.log(resposta);

                    resposta.json().then(json => {
                        console.log(json);
                        console.log(JSON.stringify(json));
                        sessionStorage.NOMEASSO_DADOS = json.nomeAsso;
                        sessionStorage.FAIXA_DADOS = json.faixa;
                        sessionStorage.NOMESENSEI_DADOS = json.nomeSensei;
                        sessionStorage.MEDALHAS_DADOS = json.medalhas;

                        setTimeout(() => {
                            cardErro.style.display = "block";
                            mensagem_erro.innerHTML =
                                "Atualizando dados...";
                        }, "2000");
                    });

                } else {
                    throw "Houve um erro ao tentar atualizar os dados!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            })
        return false;
    }

    //  Colocando o resto dos dados
    var nomeAsso = sessionStorage.NOMEASSO_DADOS;
    var nomeSensei = sessionStorage.NOMESENSEI_DADOS;
    var faixa = sessionStorage.FAIXA_DADOS;
    var medalhas = sessionStorage.MEDALHAS_DADOS;

    id_dados.innerHTML = `
    Associação: ${nomeAsso} <br>
    Sensei: ${nomeSensei} <br>
    Faixa: ${faixa} <br>
    Medalhas: ${medalhas} <br><br>
    `;

    function sumirMensagem() {
        cardErro.style.display = "none";
    }


    // Modal para adicionar dados
    function addDados() {
        const modal = document.getElementById('modalAsso')
        modal.classList.add('abrir')

        modal.addEventListener('click', (e) => {
            if (e.target.id == 'fechar' || e.target.id == 'modalAsso') {
                modal.classList.remove('abrir')
            }
        })
    }

    // Modal para adicionar kata

    function adicionarkata() {
        const modal = document.getElementById('janela-modal')
        modal.classList.add('abrir')

        modal.addEventListener('click', (e) => {
            if (e.target.id == 'fechar' || e.target.id == 'janela-modal') {
                modal.classList.remove('abrir')
            }
        })
    }

    // Gráfico dos katas

    const ctx = document.getElementById('arm5');

    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Heian Shodan', 'Heian Nidan', 'Heian Sandan', 'Heian Yodan', 'Heian Godan', 'Tekki Shodan', 'Tekki Nidan', 'Tekki Sandan', 'Bassai Dai', 'Kanku Dai', 'Empi', 'Jion', 'Jitte', 'Hangetsu', 'Gankaku', 'Bassai Sho', 'Kanku Sho', 'Chinte', 'Unsu', 'Sochin', 'Nijushiho', 'Gojushiro Dai', 'Gojushiro Sho', 'Meikyo', 'Jiin', 'Wankan'],
            datasets: [{
                label: 'Kata',
                data: [11, 12, 90, 70, 2, 3, 73, 12, 12, 50, 12, 12, 12, 39, 12, 12, 12, 95, 12, 12, 12, 12, 29, 12, 12, 12],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>